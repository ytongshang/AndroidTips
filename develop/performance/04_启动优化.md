# 启动优化

## 相关文章

-   [Android 中如何计算 App 的启动时间](https://androidperformance.com/2015/12/31/How-to-calculation-android-app-lunch-time/)
-   [历时 1 年，上百万行代码！首次揭秘手淘全链路性能优化](https://mp.weixin.qq.com/s?__biz=MzAxNDEwNjk5OQ==&mid=2650403370&idx=1&sn=b4297b138eb7f73c95a6279c3458f025&chksm=83953a32b4e2b3247fc18cbee08a2682d8b09720a1c5fef0c36257ae92b1e201cb1ad3125455&mpshare=1&scene=1&srcid=#rd)

## 启动时间计算

```bash
adb shell am start -W com.kascend.chushou/.SplashActivity
Starting: Intent { act=android.intent.action.MAIN cat=[android.intent.category.LAUNCHER] cmp=com.kascend.chushou/.SplashActivity }
Status: ok
Activity: com.kascend.chushou/.SpashActivity
ThisTime: 1673
TotalTime: 1673
WaitTime: 1719
Complete
```

-   WaitTime 就是总的耗时，包括前一个应用 Activity pause 的时间和新应用启动的时间；
-   ThisTime 表示一连串启动 Activity 的最后一个 Activity 的启动耗时；
-   TotalTime 表示新应用启动的耗时，包括新进程的启动和 Activity 的启动，但不包括前一个应用 Activity pause 的耗时

## 网络优化

### 阶段

-   发送处理阶段：网络库 bindService 影响前 x 个请求，图片并发限制图片库线程排队。
-   网络耗时：部分请求响应 size 大，包括 SO 文件，Cache 资源，图片原图大尺寸等。
-   返回处理：个别数据网关请求 json 串复杂解析严重耗时（3s）,且历史线程排队设计不合适。
-   上屏阻塞：回调 UI 线程被阻，反映主线程卡顿严重。高端机达 1s，低端机恶化达 3s 以上。
-   回调阻塞：部分业务回调执行耗时，阻塞主线程或回调线程

### 优化

-   多次重复的请求，业务方务必收敛请求次数，减少非必须请求。
-   数据大的请求如资源文件、so 文件，非启动必须统一延后或取消。
-   业务方回调执行阻塞主线程耗时过长整改。我们知道，肉眼可见流畅运行，需要运行 60 帧/秒， 意味着每帧的处理时间不超过 16ms。针对主线程执行回调超过 16ms 的业务方，推动主线程执行优化。
-   协议 json 串过于复杂导致解析耗时严重，网络并发线程数有限，解析耗时过长意味着请求长时间占用 MTOP 线程影响其他关键请求执行。推动业务方 handler 注入使用自己的线程解析或简化 json 串
